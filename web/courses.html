<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Courses | Sekay</title>
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/courses.css">
</head>
<body>
    <div class="scroll-indicator" id="scrollIndicator"></div>
    
    <header class="main-header">
        <div class="logo"><a href="home.html">Sekay</a></div>
        <nav>
            <ul class="nav-links">
                <li><a href="home.html">Home</a></li>
                <li><a href="#" id="profileLink">Profile</a></li>
                <li><a href="#" id="logoutBtn">Logout</a></li>
            </ul>
        </nav>
    </header>

    <div class="dark-mode-toggle">
        <button id="lightModeBtn" class="active">‚òÄÔ∏è</button>
        <button id="darkModeBtn">üåô</button>
    </div>

    <main class="container">
        <div class="breadcrumb">
            <a href="home.html">Home</a> &gt; 
            <a href="semester-selection.html">Select Semester</a> &gt; 
            <span id="currentSemesterText">Courses</span>
        </div>

        <section class="user-info-section">
            <div class="user-academic-info">
                <div class="academic-info-item">
                    <span class="info-label">Academic Year:</span>
                    <span class="info-value" id="academicYear">2nd Year</span>
                </div>
                <div class="academic-info-item">
                    <span class="info-label">Department:</span>
                    <span class="info-value" id="department">Computer Science</span>
                </div>
                <div class="academic-info-item">
                    <span class="info-label">Semester:</span>
                    <span class="info-value" id="currentSemester">Second Semester</span>
                </div>
            </div>
        </section>

        <section class="courses-section">
            <div class="section-header">
                <h1>Your Courses</h1>
                <div class="courses-filter">
                    <label for="filterCourses">Filter:</label>
                    <select id="filterCourses">
                        <option value="all">All Courses</option>
                        <option value="core">Core Courses</option>
                        <option value="elective">Elective Courses</option>
                    </select>
                </div>
            </div>
            
            <div class="search-wrapper">
                <input type="text" id="searchCourses" placeholder="Search courses...">
                <span class="search-icon">üîç</span>
            </div>

            <div class="courses-grid" id="coursesGrid">
                <!-- Course cards will be dynamically generated here -->
            </div>

            <div class="no-courses-message" id="noCoursesMessage" style="display: none;">
                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 24 24' fill='none' stroke='%23adb5bd' stroke-width='1' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M18 6L6 18M6 6l12 12'/%3E%3C/svg%3E" alt="No courses found">
                <p>No courses found matching your criteria</p>
                <button class="btn btn-primary" id="resetFiltersBtn">Reset Filters</button>
            </div>
        </section>

        <section class="progress-section">
            <h2>Semester Progress</h2>
            <div class="progress-cards">
                <div class="progress-card">
                    <div class="progress-info">
                        <h3>Completed Materials</h3>
                        <p class="progress-percentage">68%</p>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-filled" style="width: 68%"></div>
                    </div>
                    <p class="progress-detail">You've completed 34 out of 50 materials</p>
                </div>
                <div class="progress-card">
                    <div class="progress-info">
                        <h3>Exam Preparation</h3>
                        <p class="progress-percentage">45%</p>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-filled" style="width: 45%"></div>
                    </div>
                    <p class="progress-detail">You've studied 9 out of 20 past exams</p>
                </div>
            </div>
        </section>

        <section class="related-resources">
            <h2>Study Resources</h2>
            <div class="resources-cards">
                <div class="resource-card">
                    <div class="resource-icon library-icon"></div>
                    <div class="resource-content">
                        <h3>E-Library Access</h3>
                        <p>Access the university's digital library for additional references</p>
                        <a href="#" class="resource-link">Browse Library</a>
                    </div>
                </div>
                <div class="resource-card">
                    <div class="resource-icon tutorial-icon"></div>
                    <div class="resource-content">
                        <h3>Video Tutorials</h3>
                        <p>Watch curated tutorial videos for your courses</p>
                        <a href="#" class="resource-link">Watch Tutorials</a>
                    </div>
                </div>
                <div class="resource-card">
                    <div class="resource-icon forum-icon"></div>
                    <div class="resource-content">
                        <h3>Discussion Forums</h3>
                        <p>Join discussions with other students in your courses</p>
                        <a href="#" class="resource-link">Join Forums</a>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <div class="ai-assistant-container">
        <div class="ai-chat-window" id="aiChatWindow">
            <div class="ai-chat-header">
                <h3>AI Assistant</h3>
                <button id="closeAiChat">√ó</button>
            </div>
            <div class="ai-chat-messages" id="aiChatMessages">
                <div class="ai-message">
                    <p>Hello! I'm your Sekay assistant. Need help finding course materials?</p>
                </div>
            </div>
            <div class="ai-chat-input">
                <textarea id="aiChatInput" placeholder="Type your question..."></textarea>
                <button id="sendAiMessage" class="btn btn-primary btn-small">Send</button>
            </div>
        </div>
        <button class="ai-assistant-button" id="aiAssistantButton">
            <span>AI</span>
        </button>
    </div>

    <footer class="main-footer">
        <p>&copy; 2025 Sekay - Academic Resource Hub</p>
    </footer>

    <!-- Modal Template for Course Materials -->
    <div class="course-modal" id="courseModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalCourseName">Course Name</h2>
                <button class="close-modal" id="closeModal">√ó</button>
            </div>
            <div class="modal-body">
                <div class="course-details">
                    <div class="course-detail-item">
                        <span class="detail-label">Course Code:</span>
                        <span id="modalCourseCode" class="detail-value">CS101</span>
                    </div>
                    <div class="course-detail-item">
                        <span class="detail-label">Credit Hours:</span>
                        <span id="modalCreditHours" class="detail-value">3</span>
                    </div>
                    <div class="course-detail-item">
                        <span class="detail-label">Instructor:</span>
                        <span id="modalInstructor" class="detail-value">Dr. Smith</span>
                    </div>
                </div>
                
                <div class="materials-section">
                    <h3>Course Materials</h3>
                    <div class="materials-tabs">
                        <button class="material-tab active" data-tab="references">References</button>
                        <button class="material-tab" data-tab="lectures">Lecture Notes</button>
                        <button class="material-tab" data-tab="exams">Past Exams</button>
                    </div>
                    
                    <div class="materials-content">
                        <div class="material-content-pane active" id="referencesPane">
                            <div class="material-list" id="referencesList">
                                <!-- References will be dynamically generated here -->
                            </div>
                        </div>
                        <div class="material-content-pane" id="lecturesPane">
                            <div class="material-list" id="lecturesList">
                                <!-- Lecture notes will be dynamically generated here -->
                            </div>
                        </div>
                        <div class="material-content-pane" id="examsPane">
                            <div class="material-list" id="examsList">
                                <!-- Exams will be dynamically generated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sample Database Structure (JSON format)
        const database = {
            users: [
                {
                    id: 1,
                    name: "John Doe",
                    email: "john@example.com",
                    department: "Computer Science",
                    academic_year: 2,  // 1st year = 1, 2nd year = 2, etc.
                    completed_materials: [101, 102, 103, 104]  // IDs of materials the user has completed
                }
            ],
            courses: [
                // First Year, First Semester
                {
                    id: 1,
                    code: "CS101",
                    name: "Introduction to Programming",
                    description: "Fundamentals of programming using Python language",
                    credit_hours: 3,
                    instructor: "Dr. Robert Smith",
                    year: 1,
                    semester: 1,
                    course_type: "core",
                    image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 24 24' fill='%234361ee'%3E%3Cpath d='M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z'/%3E%3C/svg%3E"
                },
                {
                    id: 2,
                    code: "MATH121",
                    name: "Calculus I",
                    description: "Introduction to differential and integral calculus",
                    credit_hours: 4,
                    instructor: "Dr. Emily Chen",
                    year: 1,
                    semester: 1,
                    course_type: "core",
                    image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 24 24' fill='%232ec4b6'%3E%3Cpath d='M7 2v11h3v9l7-12h-4l4-8z'/%3E%3C/svg%3E"
                },
                
                // First Year, Second Semester
                {
                    id: 3,
                    code: "CS102",
                    name: "Data Structures",
                    description: "Fundamental data structures and algorithms",
                    credit_hours: 3,
                    instructor: "Dr. Michael Johnson",
                    year: 1,
                    semester: 2,
                    course_type: "core",
                    image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 24 24' fill='%23ff9f1c'%3E%3Cpath d='M12 7V3H2v18h20V7H12zM6 19H4v-2h2v2zm0-4H4v-2h2v2zm0-4H4V9h2v2zm0-4H4V5h2v2zm4 12H8v-2h2v2zm0-4H8v-2h2v2zm0-4H8V9h2v2zm0-4H8V5h2v2zm10 12h-8v-2h2v-2h-2v-2h2v-2h-2V9h8v10zm-2-8h-2v2h2v-2zm0 4h-2v2h2v-2z'/%3E%3C/svg%3E"
                },
                {
                    id: 4,
                    code: "MATH122",
                    name: "Calculus II",
                    description: "Advanced concepts in calculus and applications",
                    credit_hours: 4,
                    instructor: "Dr. Emily Chen",
                    year: 1,
                    semester: 2,
                    course_type: "core",
                    image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 24 24' fill='%232ec4b6'%3E%3Cpath d='M7 2v11h3v9l7-12h-4l4-8z'/%3E%3C/svg%3E"
                },
                
                // Second Year, First Semester
                {
                    id: 5,
                    code: "CS201",
                    name: "Object-Oriented Programming",
                    description: "OOP concepts and design patterns using Java",
                    credit_hours: 3,
                    instructor: "Dr. Sarah Williams",
                    year: 2,
                    semester: 1,
                    course_type: "core",
                    image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 24 24' fill='%234361ee'%3E%3Cpath d='M12 3L1 9l4 2.18v6L12 21l7-3.82v-6l2-1.09V17h2V9L12 3zm6.82 6L12 12.72 5.18 9 12 5.28 18.82 9zM17 15.99l-5 2.73-5-2.73v-3.72L12 15l5-2.73v3.72z'/%3E%3C/svg%3E"
                },
                {
                    id: 6,
                    code: "CS205",
                    name: "Database Systems",
                    description: "Design and implementation of database systems",
                    credit_hours: 3,
                    instructor: "Dr. David Brown",
                    year: 2,
                    semester: 1,
                    course_type: "core",
                    image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 24 24' fill='%23ff9f1c'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z'/%3E%3C/svg%3E"
                },
                {
                    id: 7,
                    code: "MATH231",
                    name: "Discrete Mathematics",
                    description: "Set theory, logic, and combinatorics for computer science",
                    credit_hours: 3,
                    instructor: "Dr. James Wilson",
                    year: 2,
                    semester: 1,
                    course_type: "core",
                    image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 24 24' fill='%232ec4b6'%3E%3Cpath d='M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14h-2V9h-2V7h4v10z'/%3E%3C/svg%3E"
                },
                {
                    id: 8,
                    code: "HUM201",
                    name: "Technical Writing",
                    description: "Professional communication for technical fields",
                    credit_hours: 2,
                    instructor: "Prof. Laura Adams",
                    year: 2,
                    semester: 1,
                    course_type: "elective",
                    image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 24 24' fill='%234361ee'%3E%3Cpath d='M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z'/%3E%3C/svg%3E"
                },
                
                // Second Year, Second Semester
                {
                    id: 9,
                    code: "CS210",
                    name: "Algorithms & Complexity",
                    description: "Analysis and design of algorithms",
                    credit_hours: 3,
                    instructor: "Dr. Michael Johnson",
                    year: 2,
                    semester: 2,
                    course_type: "core",
                    image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 24 24' fill='%234361ee'%3E%3Cpath d='M15 15H3v2h12v-2zm0-8H3v2h12V7zM3 13h18v-2H3v2zm0 8h18v-2H3v2zM3 3v2h18V3H3z'/%3E%3C/svg%3E"
                },
                {
                    id: 10,
                    code: "CS215",
                    name: "Computer Networks",
                    description: "Principles and practices of computer networking",
                    credit_hours: 4,
                    instructor: "Dr. Thomas Lee",
                    year: 2,
                    semester: 2,
                    course_type: "core",
                    image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 24 24' fill='%23ff9f1c'%3E%3Cpath d='M21 1l-8 8-4-4-9 9 1.41 1.41L9 7.83l4 4 9.59-9.59L21 1z'/%3E%3C/svg%3E"
                },
                {
                    id: 11,
                    code: "CS220",
                    name: "Web Development",
                    description: "Modern web development technologies and practices",
                    credit_hours: 3,
                    instructor: "Dr. Julia Garcia",
                    year: 2,
                    semester: 2,
                    course_type: "elective",
                    image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 24 24' fill='%234361ee'%3E%3Cpath d='M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 14H4v-4h11v4zm0-5H4V9h11v4zm5 5h-4V9h4v9z'/%3E%3C/svg%3E"
                },
                {
                    id: 12,
                    code: "CS225",
                    name: "Operating Systems",
                    description: "Concepts and design of operating systems",
                    credit_hours: 3,
                    instructor: "Dr. Robert Davis",
                    year: 2,
                    semester: 2,
                    course_type: "core",
                    image: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 24 24' fill='%232ec4b6'%3E%3Cpath d='M15 9H9v6h6V9zm-2 4h-2v-2h2v2zm8-2V9h-2V7c0-1.1-.9-2-2-2h-2V3h-2v2h-2V3H9v2H7c-1.1 0-2 .9-2 2v2H3v2h2v2H3v2h2v2c0 1.1.9 2 2 2h2v2h2v-2h2v2h2v-2h2c1.1 0 2-.9 2-2v-2h2v-2h-2v-2h2zm-4 6H7V7h10v10z'/%3E%3C/svg%3E"
                }
            ],
            materials: [
                // Sample references (books, articles, etc.)
                {
                    id: 101,
                    course_id: 9,
                    name: "Introduction to Algorithms",
                    type: "reference",
                    author: "Cormen, Leiserson, Rivest, Stein",
                    year: 2022,
                    file_path: "/materials/algorithms/intro_algorithms.pdf",
                    size: "8.5 MB",
                    download_count: 342
                },
                {
                    id: 102,
                    course_id: 9,
                    name: "Algorithm Design Manual",
                    type: "reference",
                    author: "Steven Skiena",
                    year: 2020,
                    file_path: "/materials/algorithms/design_manual.pdf",
                    size: "12.1 MB",
                    download_count: 215
                },
                
                // Sample lecture notes
                {
                    id: 103,
                    course_id: 9,
                    name: "Lecture 1: Introduction to Algorithm Analysis",
                    type: "lecture",
                    date: "2025-02-10",
                    author: "Dr. Michael Johnson",
                    file_path: "/materials/algorithms/lecture1.pdf",
                    size: "2.3 MB",
                    download_count: 198
                },
                {
                    id: 104,
                    course_id: 9,
                    name: "Lecture 2: Asymptotic Notation",
                    type: "lecture",
                    date: "2025-02-17",
                    author: "Dr. Michael Johnson",
                    file_path: "/materials/algorithms/lecture2.pdf",
                    size: "1.8 MB",
                    download_count: 187
                },
                
                // Sample exams
                {
                    id: 105,
                    course_id: 9,
                    name: "Midterm Exam 2024",
                    type: "exam",
                    date: "2024-03-15",
                    file_path: "/materials/algorithms/midterm_2024.pdf",
                    size: "1.2 MB",
                    download_count: 276
                },
                {
                    id: 106,
                    course_id: 9,
                    name: "Final Exam 2024",
                    type: "exam",
                    date: "2024-06-10",
                    file_path: "/materials/algorithms/final_2024.pdf",
                    size: "1.5 MB",
                    download_count: 312
                },
                
                // More sample materials for Computer Networks
                {
                    id: 107,
                    course_id: 10,
                    name: "Computer Networking: A Top-Down Approach",
                    type: "reference",
                    author: "Kurose & Ross",
                    year: 2023,
                    file_path: "/materials/networks/topdown_approach.pdf",
                    size: "15.2 MB",
                    download_count: 189
                },
                {
                    id: 108,
                    course_id: 10,
                    name: "Lecture 1: Introduction to Networks",
                    type: "lecture",
                    date: "2025-02-12",
                    author: "Dr. Thomas Lee",
                    file_path: "/materials/networks/lecture1.pdf",
                    size: "3.1 MB",
                    download_count: 156
                },
                {
                    id: 109,
                    course_id: 10,
                    name: "Midterm Exam 2024",
                    type: "exam",
                    date: "2024-03-20",
                    file_path: "/materials/networks/midterm_2024.pdf",
                    size: "1.4 MB",
                    download_count: 178
                }
            ]
        };

        // Current user and semester (would normally come from session/login)
        let currentUser = database.users[0];  // Simulating logged-in user
        let currentSemester = null;

        // Function to get URL parameters
        function getUrlParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Get semester from URL parameter
            currentSemester = parseInt(getUrlParam('semester')) || 1;
            
            // Update UI with current user and semester info
            document.getElementById('academicYear').textContent = `${currentUser.academic_year}${getOrdinal(currentUser.academic_year)} Year`;
            document.getElementById('department').textContent = currentUser.department;
            document.getElementById('currentSemester').textContent = currentSemester === 1 ? 'First Semester' : 'Second Semester';
            document.getElementById('currentSemesterText').textContent = `${currentSemester === 1 ? 'First' : 'Second'} Semester Courses`;
            
            // Load courses for the selected semester and academic year
            loadCourses();
            
            // Setup event listeners
            setupEventListeners();
            
            // Load saved dark mode preference
            if (localStorage.getItem('darkMode') === 'enabled') {
                document.getElementById('darkModeBtn').click();
            }
        });

        // Get ordinal suffix for numbers (1st, 2nd, 3rd, etc.)
        function getOrdinal(n) {
            const s = ["th", "st", "nd", "rd"];
            const v = n % 100;
            return (s[(v - 20) % 10] || s[v] || s[0]);
        }

        // Load courses based on academic year and semester
        function loadCourses() {
            const coursesGrid = document.getElementById('coursesGrid');
            coursesGrid.innerHTML = '';
            
            const filteredCourses = database.courses.filter(course => 
                course.year === currentUser.academic_year && 
                course.semester === currentSemester
            );
            
            if (filteredCourses.length === 0) {
                document.getElementById('noCoursesMessage').style.display = 'flex';
                return;
            }
            
            document.getElementById('noCoursesMessage').style.display = 'none';
            
            filteredCourses.forEach(course => {
                // Count materials for this course
                const courseMaterials = database.materials.filter(material => material.course_id === course.id);
                const referenceCount = courseMaterials.filter(m => m.type === 'reference').length;
                const lectureCount = courseMaterials.filter(m => m.type === 'lecture').length;
                const examCount = courseMaterials.filter(m => m.type === 'exam').length;
                
                const courseCard = document.createElement('div');
                courseCard.className = `course-card ${course.course_type}`;
                courseCard.setAttribute('data-course-id', course.id);
                courseCard.setAttribute('data-course-type', course.course_type);
                
                courseCard.innerHTML = `
                    <div class="course-header">
                        <div class="course-image">
                            ${course.image}
                        </div>
                        <span class="course-code">${course.code}</span>
                        <span class="course-type ${course.course_type}">${course.course_type}</span>
                    </div>
                    <div class="course-body">
                        <h3 class="course-name">${course.name}</h3>
                        <p class="course-description">${course.description}</p>
                        <div class="course-stats">
                            <span class="stat-item"><i class="material-icon reference-icon"></i> ${referenceCount}</span>
                            <span class="stat-item"><i class="material-icon lecture-icon"></i> ${lectureCount}</span>
                            <span class="stat-item"><i class="material-icon exam-icon"></i> ${examCount}</span>
                        </div>
                    </div>
                    <div class="course-footer">
                        <span class="instructor">${course.instructor}</span>
                        <button class="view-materials-btn">View Materials</button>
                    </div>
                `;
                
                coursesGrid.appendChild(courseCard);
                
                // Add click event to view materials button
                courseCard.querySelector('.view-materials-btn').addEventListener('click', function() {
                    openCourseModal(course);
                });
            });
        }

        // Open course modal with materials
        function openCourseModal(course) {
            const modal = document.getElementById('courseModal');
            const courseMaterials = database.materials.filter(material => material.course_id === course.id);
            
            // Set course details in modal
            document.getElementById('modalCourseName').textContent = course.name;
            document.getElementById('modalCourseCode').textContent = course.code;
            document.getElementById('modalCreditHours').textContent = course.credit_hours;
            document.getElementById('modalInstructor').textContent = course.instructor;
            
            // Load references
            const referencesList = document.getElementById('referencesList');
            referencesList.innerHTML = '';
            
            const references = courseMaterials.filter(m => m.type === 'reference');
            if (references.length === 0) {
                referencesList.innerHTML = '<p class="no-materials-message">No reference materials available for this course.</p>';
            } else {
                references.forEach(ref => {
                    const refItem = document.createElement('div');
                    refItem.className = 'material-item';
                    refItem.innerHTML = `
                        <div class="material-info">
                            <h4>${ref.name}</h4>
                            <p class="material-author">${ref.author} (${ref.year})</p>
                            <p class="material-meta">
                                <span class="material-size">${ref.size}</span>
                                <span class="material-downloads">${ref.download_count} downloads</span>
                            </p>
                        </div>
                        <a href="#" class="download-btn" data-file="${ref.file_path}">Download</a>
                    `;
                    referencesList.appendChild(refItem);
                });
            }
            
            // Load lecture notes
            const lecturesList = document.getElementById('lecturesList');
            lecturesList.innerHTML = '';
            
            const lectures = courseMaterials.filter(m => m.type === 'lecture');
            if (lectures.length === 0) {
                lecturesList.innerHTML = '<p class="no-materials-message">No lecture notes available for this course.</p>';
            } else {
                lectures.forEach(lecture => {
                    const lectureItem = document.createElement('div');
                    lectureItem.className = 'material-item';
                    lectureItem.innerHTML = `
                        <div class="material-info">
                            <h4>${lecture.name}</h4>
                            <p class="material-date">${formatDate(lecture.date)}</p>
                            <p class="material-meta">
                                <span class="material-size">${lecture.size}</span>
                                <span class="material-downloads">${lecture.download_count} downloads</span>
                            </p>
                        </div>
                        <a href="#" class="download-btn" data-file="${lecture.file_path}">Download</a>
                    `;
                    lecturesList.appendChild(lectureItem);
                });
            }
            
            // Load exams
            const examsList = document.getElementById('examsList');
            examsList.innerHTML = '';
            
            const exams = courseMaterials.filter(m => m.type === 'exam');
            if (exams.length === 0) {
                examsList.innerHTML = '<p class="no-materials-message">No past exams available for this course.</p>';
            } else {
                exams.forEach(exam => {
                    const examItem = document.createElement('div');
                    examItem.className = 'material-item';
                    examItem.innerHTML = `
                        <div class="material-info">
                            <h4>${exam.name}</h4>
                            <p class="material-date">${formatDate(exam.date)}</p>
                            <p class="material-meta">
                                <span class="material-size">${exam.size}</span>
                                <span class="material-downloads">${exam.download_count} downloads</span>
                            </p>
                        </div>
                        <a href="#" class="download-btn" data-file="${exam.file_path}">Download</a>
                    `;
                    examsList.appendChild(examItem);
                });
            }
            
            // Display modal
            modal.classList.add('active');
            document.body.style.overflow = 'hidden'; // Prevent scrolling when modal is open
        }

        // Format date in a user-friendly way
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }

        // Setup all event listeners
        function setupEventListeners() {
            // Dark mode toggle
            document.getElementById('darkModeBtn').addEventListener('click', function() {
                document.body.classList.add('dark-mode');
                this.classList.add('active');
                document.getElementById('lightModeBtn').classList.remove('active');
                localStorage.setItem('darkMode', 'enabled');
            });
            
            document.getElementById('lightModeBtn').addEventListener('click', function() {
                document.body.classList.remove('dark-mode');
                this.classList.add('active');
                document.getElementById('darkModeBtn').classList.remove('active');
                localStorage.setItem('darkMode', 'disabled');
            });
            
            // Scroll indicator
            window.addEventListener('scroll', function() {
                const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
                const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
                const scrolled = (winScroll / height) * 100;
                document.getElementById('scrollIndicator').style.width = scrolled + '%';
            });
            
            // Course filter
            document.getElementById('filterCourses').addEventListener('change', function() {
                const filter = this.value;
                const courses = document.querySelectorAll('.course-card');
                
                if (filter === 'all') {
                    courses.forEach(course => course.style.display = 'flex');
                } else {
                    courses.forEach(course => {
                        if (course.getAttribute('data-course-type') === filter) {
                            course.style.display = 'flex';
                        } else {
                            course.style.display = 'none';
                        }
                    });
                }
                
                // Check if no courses are visible
                const visibleCourses = document.querySelectorAll('.course-card[style="display: flex"]');
                if (visibleCourses.length === 0) {
                    document.getElementById('noCoursesMessage').style.display = 'flex';
                } else {
                    document.getElementById('noCoursesMessage').style.display = 'none';
                }
            });
            
            // Course search
            document.getElementById('searchCourses').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const courses = document.querySelectorAll('.course-card');
                let hasVisibleCourses = false;
                
                courses.forEach(course => {
                    const courseName = course.querySelector('.course-name').textContent.toLowerCase();
                    const courseCode = course.querySelector('.course-code').textContent.toLowerCase();
                    const courseDesc = course.querySelector('.course-description').textContent.toLowerCase();
                    
                    if (courseName.includes(searchTerm) || courseCode.includes(searchTerm) || courseDesc.includes(searchTerm)) {
                        course.style.display = 'flex';
                        hasVisibleCourses = true;
                    } else {
                        course.style.display = 'none';
                    }
                });
                
                document.getElementById('noCoursesMessage').style.display = hasVisibleCourses ? 'none' : 'flex';
            });
            
            // Reset filters button
            document.getElementById('resetFiltersBtn').addEventListener('click', function() {
                document.getElementById('filterCourses').value = 'all';
                document.getElementById('searchCourses').value = '';
                const courses = document.querySelectorAll('.course-card');
                courses.forEach(course => course.style.display = 'flex');
                document.getElementById('noCoursesMessage').style.display = 'none';
            });
            
            // Close modal
            document.getElementById('closeModal').addEventListener('click', function() {
                document.getElementById('courseModal').classList.remove('active');
                document.body.style.overflow = 'auto'; // Re-enable scrolling
            });
            
            // Click outside to close modal
            window.addEventListener('click', function(event) {
                const modal = document.getElementById('courseModal');
                if (event.target === modal) {
                    modal.classList.remove('active');
                    document.body.style.overflow = 'auto'; // Re-enable scrolling
                }
            });
            
            // Material tabs
            document.querySelectorAll('.material-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs
                    document.querySelectorAll('.material-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Hide all content panes
                    document.querySelectorAll('.material-content-pane').forEach(pane => pane.classList.remove('active'));
                    
                    // Show selected pane
                    const tabName = this.getAttribute('data-tab');
                    document.getElementById(`${tabName}Pane`).classList.add('active');
                });
            });
            
            // Download buttons
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('download-btn')) {
                    e.preventDefault();
                    const filePath = e.target.getAttribute('data-file');
                    
                    // In a real application, this would trigger a download
                    // Here we'll just show an alert
                    alert(`Downloading file: ${filePath}`);
                    
                    // Increment download count (in a real app, this would be handled server-side)
                    const materialId = parseInt(e.target.closest('.material-item').getAttribute('data-material-id'));
                    if (materialId) {
                        const material = database.materials.find(m => m.id === materialId);
                        if (material) {
                            material.download_count++;
                        }
                    }
                }
            });
            
            // AI Assistant functionality
            const aiButton = document.getElementById('aiAssistantButton');
            const aiWindow = document.getElementById('aiChatWindow');
            const closeAiBtn = document.getElementById('closeAiChat');
            const sendAiBtn = document.getElementById('sendAiMessage');
            const aiInput = document.getElementById('aiChatInput');
            const aiMessages = document.getElementById('aiChatMessages');
            
            aiButton.addEventListener('click', function() {
                aiWindow.classList.toggle('active');
            });
            
            closeAiBtn.addEventListener('click', function() {
                aiWindow.classList.remove('active');
            });
            
            sendAiBtn.addEventListener('click', function() {
                const message = aiInput.value.trim();
                
                if (message) {
                    // Add user message
                    const userMessageDiv = document.createElement('div');
                    userMessageDiv.className = 'user-message';
                    userMessageDiv.innerHTML = `<p>${message}</p>`;
                    aiMessages.appendChild(userMessageDiv);
                    
                    // Clear input
                    aiInput.value = '';
                    
                    // Mock AI response
                    setTimeout(() => {
                        const aiMessageDiv = document.createElement('div');
                        aiMessageDiv.className = 'ai-message';
                        
                        // Customized response for courses page
                        if (message.toLowerCase().includes('material') || message.toLowerCase().includes('download')) {
                            aiMessageDiv.innerHTML = `<p>To access course materials, click on the "View Materials" button on any course card. You can then download references, lecture notes, or past exams.</p>`;
                        } else if (message.toLowerCase().includes('filter') || message.toLowerCase().includes('search')) {
                            aiMessageDiv.innerHTML = `<p>You can filter courses by type (core or elective) using the dropdown menu, or search for specific courses using the search box above the course grid.</p>`;
                        } else {
                            aiMessageDiv.innerHTML = `<p>I'm here to help you navigate your courses. You can ask me about finding materials, filtering courses, or understanding course requirements.</p>`;
                        }
                        
                        aiMessages.appendChild(aiMessageDiv);
                        aiMessages.scrollTop = aiMessages.scrollHeight;
                    }, 1000);
                    
                    aiMessages.scrollTop = aiMessages.scrollHeight;
                }
            });
            
            aiInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendAiBtn.click();
                }
            });
        }
    </script>
</body>
</html>